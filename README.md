# 画像合成自動化ツール

複数の商品素材と所定のテキスト、イラスト、背景などを自動的に合成するツールです。

## 概要

このアプリケーションでは以下の機能を提供します：

- テンプレート管理機能
  - テンプレートの作成、編集、削除
  - プレビュー機能
- バッチ処理機能
  - CSVファイルから商品情報を読み込み
  - テンプレートに基づいた画像合成
  - 大量の画像を一括処理

## 動作環境

- Python 3.8以上
- 必要なライブラリ：flet, pillow, pandas

## インストール方法

```bash
# 仮想環境を作成
python -m venv .venv

# 仮想環境を有効化
# Windows
.venv\Scripts\activate
# macOS/Linux
source .venv/bin/activate

# 依存パッケージをインストール
pip install -r requirements.txt
```

## 使用方法

### GUIモード（通常利用）

```bash
python main.py
```

GUIが起動し、以下の操作が可能です：

1. テンプレート管理
   - 新規テンプレート作成
   - 既存テンプレートの編集・削除
   - テキスト配置、画像配置などの編集

2. バッチ処理
   - 商品情報CSVの選択
   - 商品画像フォルダの選択
   - 出力先フォルダの選択
   - テンプレートの選択
   - 処理実行

### コマンドラインモード（バッチ処理）

GUIを起動せずにバッチ処理のみを実行することも可能です：

```bash
python main.py --batch --csv <商品CSVパス> --images <画像フォルダパス> --output <出力フォルダパス> --template <テンプレートパス>
```

または、以下のバッチランナーを使用することもできます：

```bash
python batch_runner.py <商品CSVパス> <画像フォルダパス> <出力フォルダパス> <テンプレートパス>
```

#### パラメータ
- `<商品CSVパス>`: 商品情報のCSVファイル
- `<画像フォルダパス>`: 商品画像が格納されているフォルダ
- `<出力フォルダパス>`: 合成画像の出力先フォルダ
- `<テンプレートパス>`: 使用するテンプレートのJSONファイル

### CSVファイル形式

以下のフォーマットのCSVファイルを用意してください：

```csv
id,name,price,image_file
1,商品名1,1000,product1.png
2,商品名2,2000,product2.png
```

- `id`: 商品ID（出力ファイル名に使用）
- `name`: 商品名（テンプレート内で${name}として参照可能）
- `price`: 価格（テンプレート内で${price}として参照可能）
- `image_file`: 商品画像のファイル名

## テンプレート形式

テンプレートはJSON形式で保存され、以下の要素を含みます：

```json
{
  "name": "テンプレート名",
  "background": "背景画像パス",
  "product_position": [x, y],
  "product_size": [width, height],
  "text_elements": [
    {
      "text": "${name}",
      "position": [x, y],
      "font": "フォント名",
      "font_size": サイズ,
      "color": [R, G, B]
    }
  ],
  "image_elements": [
    {
      "path": "装飾画像パス",
      "position": [x, y],
      "size": [width, height]
    }
  ]
}
```

## テスト実行方法

単体テストを実行するには以下のコマンドを使用します：

```bash
# すべてのテストを一括実行
python run_tests.py

# 個別テストの実行
python test_data_handler.py
python test_template_manager.py
python test_batch_process.py
```

## エラーについて

エラーが発生した場合は以下を確認してください：

1. 仮想環境が有効化されているか
2. 必要なパッケージがインストールされているか
3. 画像ファイルパスが正しいか
4. 十分な権限があるか（ファイル読み書き権限）

詳細なエラーはログに出力されます。

## 注意事項

- 大量の画像処理を行う場合はメモリ使用量に注意してください
- 画像サイズが大きい場合は処理に時間がかかることがあります
- テンプレート編集中はこまめに保存することをお勧めします

## ライセンス

このアプリケーションはフリーソフトウェアとして公開しています。
